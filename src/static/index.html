<!-- Author: Philip Zingmark, all the contributors to the original project are on the github of the original project            -->
<!-- A Emscripten port of our first year project https://github.com/Phillezi/CatClash (Its a SDL2 multiplayer game made in c)   -->
<!-- Not everything is ported, for example multiplayer capabilities and a bunch of bugs are present                             -->
<!DOCTYPE html>
<html>

<head>
    <title>CATCLASH WEB BUILD</title>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <style>
        body {
            background-color: black;
            color: white;
            margin: 0;
            overflow: hidden;
        }
        
        #canvas {
            display: block;
        }
        
        #overlay {
            margin-left: 10%;
            width: 80%;
            display: flex;
            position: fixed;
            bottom: 10px;
            align-self: center;
            justify-content: space-between;
            align-items: center;
            z-index: 1;
        }
        
        button {
            font-size: 16px;
            margin: 5px;
            padding: 10px;
        }
    </style>
</head>

<body>
    <center>
        <canvas id="canvas"></canvas>
        <div id="overlay">
            <div id="left">
                <button id="spaceButton">Space</button>
            </div>
            <div id="right">
                <button id="upButton">&uarr;</button>
                <br>
                <button id="leftButton">&larr;</button>
                <button id="downButton">&darr;</button>
                <button id="rightButton">&rarr;</button>
            </div>
        </div>
        <script type='text/javascript'>
            var Module = {
                canvas: (function() {
                    return document.getElementById('canvas');
                })()
            };
        </script>
        <script src="index.js"></script>
        <script>
            function simulateKeyPress(keyCode) {
                var eventObj = document.createEventObject ?
                    document.createEventObject() : document.createEvent("Events");

                if (eventObj.initEvent) {
                    eventObj.initEvent("keydown", true, true);
                }

                eventObj.keyCode = keyCode;
                eventObj.which = keyCode;

                document.dispatchEvent ? document.dispatchEvent(eventObj) : document.fireEvent("onkeydown", eventObj);
            }

            function simulateKeyRelease(keyCode) {
                var eventObj = document.createEventObject ?
                    document.createEventObject() : document.createEvent("Events");

                if (eventObj.initEvent) {
                    eventObj.initEvent("keyup", true, true);
                }

                eventObj.keyCode = keyCode;
                eventObj.which = keyCode;

                document.dispatchEvent ? document.dispatchEvent(eventObj) : document.fireEvent("onkeyup", eventObj);
            }

            var upButton = document.getElementById('upButton');
            var leftButton = document.getElementById('leftButton');
            var downButton = document.getElementById('downButton');
            var rightButton = document.getElementById('rightButton');
            var spaceButton = document.getElementById('spaceButton');

            var intervalId;

            function startInterval(keyCode) {
                intervalId = setInterval(function() {
                    simulateKeyPress(keyCode);
                }, 100);
            }

            function stopInterval(keyCode) {
                clearInterval(intervalId);
                simulateKeyRelease(keyCode);
            }

            function handleTouchEvent(button, keyCode) {
                button.addEventListener('touchstart', function(event) {
                    event.preventDefault();
                    startInterval(keyCode);
                });

                button.addEventListener('touchend', function(event) {
                    event.preventDefault();
                    stopInterval(keyCode);
                });

                button.addEventListener('touchcancel', function(event) {
                    event.preventDefault();
                    stopInterval(keyCode);
                });
            }

            handleTouchEvent(upButton, 38); // up arrow key
            handleTouchEvent(leftButton, 37); // left arrow key
            handleTouchEvent(downButton, 40); // down arrow key
            handleTouchEvent(rightButton, 39); // right arrow key
            handleTouchEvent(spaceButton, 32); // space key
        </script>
    </center>
</body>

</html>